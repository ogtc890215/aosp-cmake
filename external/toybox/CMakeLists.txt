project(toybox)

set(TOYBOX_ROOT ${ANDROID_ROOT}/external/toybox)

set(SOURCE_FILES
        ${TOYBOX_ROOT}/lib/args.c
        ${TOYBOX_ROOT}/lib/dirtree.c
        ${TOYBOX_ROOT}/lib/getmountlist.c
        ${TOYBOX_ROOT}/lib/help.c
        ${TOYBOX_ROOT}/lib/interestingtimes.c
        ${TOYBOX_ROOT}/lib/lib.c
        ${TOYBOX_ROOT}/lib/linestack.c
        ${TOYBOX_ROOT}/lib/llist.c
        ${TOYBOX_ROOT}/lib/net.c
        ${TOYBOX_ROOT}/lib/portability.c
        ${TOYBOX_ROOT}/lib/xwrap.c
        ${TOYBOX_ROOT}/main.c
        ${TOYBOX_ROOT}/toys/android/getenforce.c
        ${TOYBOX_ROOT}/toys/android/getprop.c
        ${TOYBOX_ROOT}/toys/android/load_policy.c
        ${TOYBOX_ROOT}/toys/android/log.c
        ${TOYBOX_ROOT}/toys/android/restorecon.c
        ${TOYBOX_ROOT}/toys/android/runcon.c
        ${TOYBOX_ROOT}/toys/android/sendevent.c
        ${TOYBOX_ROOT}/toys/android/setenforce.c
        ${TOYBOX_ROOT}/toys/android/setprop.c
        ${TOYBOX_ROOT}/toys/android/start.c
        ${TOYBOX_ROOT}/toys/lsb/dmesg.c
        ${TOYBOX_ROOT}/toys/lsb/hostname.c
        ${TOYBOX_ROOT}/toys/lsb/killall.c
        ${TOYBOX_ROOT}/toys/lsb/md5sum.c
        ${TOYBOX_ROOT}/toys/lsb/mknod.c
        ${TOYBOX_ROOT}/toys/lsb/mktemp.c
        ${TOYBOX_ROOT}/toys/lsb/mount.c
        ${TOYBOX_ROOT}/toys/lsb/pidof.c
        ${TOYBOX_ROOT}/toys/lsb/seq.c
        ${TOYBOX_ROOT}/toys/lsb/sync.c
        ${TOYBOX_ROOT}/toys/lsb/umount.c
        ${TOYBOX_ROOT}/toys/net/ifconfig.c
        ${TOYBOX_ROOT}/toys/net/microcom.c
        ${TOYBOX_ROOT}/toys/net/netcat.c
        ${TOYBOX_ROOT}/toys/net/netstat.c
        ${TOYBOX_ROOT}/toys/net/rfkill.c
        ${TOYBOX_ROOT}/toys/net/tunctl.c
        ${TOYBOX_ROOT}/toys/other/acpi.c
        ${TOYBOX_ROOT}/toys/other/base64.c
        ${TOYBOX_ROOT}/toys/other/blkid.c
        ${TOYBOX_ROOT}/toys/other/blockdev.c
        ${TOYBOX_ROOT}/toys/other/chcon.c
        ${TOYBOX_ROOT}/toys/other/chroot.c
        ${TOYBOX_ROOT}/toys/other/chrt.c
        ${TOYBOX_ROOT}/toys/other/clear.c
        ${TOYBOX_ROOT}/toys/other/dos2unix.c
        ${TOYBOX_ROOT}/toys/other/fallocate.c
        ${TOYBOX_ROOT}/toys/other/flock.c
        ${TOYBOX_ROOT}/toys/other/free.c
        ${TOYBOX_ROOT}/toys/other/freeramdisk.c
        ${TOYBOX_ROOT}/toys/other/fsfreeze.c
        ${TOYBOX_ROOT}/toys/other/help.c
        ${TOYBOX_ROOT}/toys/other/hwclock.c
        ${TOYBOX_ROOT}/toys/other/inotifyd.c
        ${TOYBOX_ROOT}/toys/other/insmod.c
        ${TOYBOX_ROOT}/toys/other/ionice.c
        ${TOYBOX_ROOT}/toys/other/losetup.c
        ${TOYBOX_ROOT}/toys/other/lsattr.c
        ${TOYBOX_ROOT}/toys/other/lsmod.c
        ${TOYBOX_ROOT}/toys/other/lspci.c
        ${TOYBOX_ROOT}/toys/other/lsusb.c
        ${TOYBOX_ROOT}/toys/other/makedevs.c
        ${TOYBOX_ROOT}/toys/other/mkswap.c
        ${TOYBOX_ROOT}/toys/other/modinfo.c
        ${TOYBOX_ROOT}/toys/other/mountpoint.c
        ${TOYBOX_ROOT}/toys/other/nbd_client.c
        ${TOYBOX_ROOT}/toys/other/partprobe.c
        ${TOYBOX_ROOT}/toys/other/pivot_root.c
        ${TOYBOX_ROOT}/toys/other/pmap.c
        ${TOYBOX_ROOT}/toys/other/printenv.c
        ${TOYBOX_ROOT}/toys/other/pwdx.c
        ${TOYBOX_ROOT}/toys/other/readlink.c
        ${TOYBOX_ROOT}/toys/other/realpath.c
        ${TOYBOX_ROOT}/toys/other/rev.c
        ${TOYBOX_ROOT}/toys/other/rmmod.c
        ${TOYBOX_ROOT}/toys/other/setsid.c
        ${TOYBOX_ROOT}/toys/other/stat.c
        ${TOYBOX_ROOT}/toys/other/swapoff.c
        ${TOYBOX_ROOT}/toys/other/swapon.c
        ${TOYBOX_ROOT}/toys/other/sysctl.c
        ${TOYBOX_ROOT}/toys/other/tac.c
        ${TOYBOX_ROOT}/toys/other/taskset.c
        ${TOYBOX_ROOT}/toys/other/timeout.c
        ${TOYBOX_ROOT}/toys/other/truncate.c
        ${TOYBOX_ROOT}/toys/other/uptime.c
        ${TOYBOX_ROOT}/toys/other/usleep.c
        ${TOYBOX_ROOT}/toys/other/vconfig.c
        ${TOYBOX_ROOT}/toys/other/vmstat.c
        ${TOYBOX_ROOT}/toys/other/which.c
        ${TOYBOX_ROOT}/toys/other/xxd.c
        ${TOYBOX_ROOT}/toys/other/yes.c
        ${TOYBOX_ROOT}/toys/pending/dd.c
        ${TOYBOX_ROOT}/toys/pending/diff.c
        ${TOYBOX_ROOT}/toys/pending/expr.c
        ${TOYBOX_ROOT}/toys/pending/getfattr.c
        ${TOYBOX_ROOT}/toys/pending/gzip.c
        ${TOYBOX_ROOT}/toys/pending/lsof.c
        ${TOYBOX_ROOT}/toys/pending/modprobe.c
        ${TOYBOX_ROOT}/toys/pending/more.c
        ${TOYBOX_ROOT}/toys/pending/setfattr.c
        ${TOYBOX_ROOT}/toys/pending/tar.c
        ${TOYBOX_ROOT}/toys/pending/tr.c
        ${TOYBOX_ROOT}/toys/pending/traceroute.c
        ${TOYBOX_ROOT}/toys/posix/basename.c
        ${TOYBOX_ROOT}/toys/posix/cal.c
        ${TOYBOX_ROOT}/toys/posix/cat.c
        ${TOYBOX_ROOT}/toys/posix/chgrp.c
        ${TOYBOX_ROOT}/toys/posix/chmod.c
        ${TOYBOX_ROOT}/toys/posix/cksum.c
        ${TOYBOX_ROOT}/toys/posix/cmp.c
        ${TOYBOX_ROOT}/toys/posix/comm.c
        ${TOYBOX_ROOT}/toys/posix/cp.c
        ${TOYBOX_ROOT}/toys/posix/cpio.c
        ${TOYBOX_ROOT}/toys/posix/cut.c
        ${TOYBOX_ROOT}/toys/posix/date.c
        ${TOYBOX_ROOT}/toys/posix/df.c
        ${TOYBOX_ROOT}/toys/posix/dirname.c
        ${TOYBOX_ROOT}/toys/posix/du.c
        ${TOYBOX_ROOT}/toys/posix/echo.c
        ${TOYBOX_ROOT}/toys/posix/env.c
        ${TOYBOX_ROOT}/toys/posix/expand.c
        ${TOYBOX_ROOT}/toys/posix/false.c
        ${TOYBOX_ROOT}/toys/posix/file.c
        ${TOYBOX_ROOT}/toys/posix/find.c
        ${TOYBOX_ROOT}/toys/posix/grep.c
        ${TOYBOX_ROOT}/toys/posix/head.c
        ${TOYBOX_ROOT}/toys/posix/id.c
        ${TOYBOX_ROOT}/toys/posix/kill.c
        ${TOYBOX_ROOT}/toys/posix/ln.c
        ${TOYBOX_ROOT}/toys/posix/ls.c
        ${TOYBOX_ROOT}/toys/posix/mkdir.c
        ${TOYBOX_ROOT}/toys/posix/mkfifo.c
        ${TOYBOX_ROOT}/toys/posix/nice.c
        ${TOYBOX_ROOT}/toys/posix/nl.c
        ${TOYBOX_ROOT}/toys/posix/nohup.c
        ${TOYBOX_ROOT}/toys/posix/od.c
        ${TOYBOX_ROOT}/toys/posix/paste.c
        ${TOYBOX_ROOT}/toys/posix/patch.c
        ${TOYBOX_ROOT}/toys/posix/printf.c
        ${TOYBOX_ROOT}/toys/posix/ps.c
        ${TOYBOX_ROOT}/toys/posix/pwd.c
        ${TOYBOX_ROOT}/toys/posix/renice.c
        ${TOYBOX_ROOT}/toys/posix/rm.c
        ${TOYBOX_ROOT}/toys/posix/rmdir.c
        ${TOYBOX_ROOT}/toys/posix/sed.c
        ${TOYBOX_ROOT}/toys/posix/sleep.c
        ${TOYBOX_ROOT}/toys/posix/sort.c
        ${TOYBOX_ROOT}/toys/posix/split.c
        ${TOYBOX_ROOT}/toys/posix/strings.c
        ${TOYBOX_ROOT}/toys/posix/tail.c
        ${TOYBOX_ROOT}/toys/posix/tee.c
        ${TOYBOX_ROOT}/toys/posix/time.c
        ${TOYBOX_ROOT}/toys/posix/touch.c
        ${TOYBOX_ROOT}/toys/posix/true.c
        ${TOYBOX_ROOT}/toys/posix/tty.c
        ${TOYBOX_ROOT}/toys/posix/ulimit.c
        ${TOYBOX_ROOT}/toys/posix/uname.c
        ${TOYBOX_ROOT}/toys/posix/uniq.c
        ${TOYBOX_ROOT}/toys/posix/uudecode.c
        ${TOYBOX_ROOT}/toys/posix/uuencode.c
        ${TOYBOX_ROOT}/toys/posix/wc.c
        ${TOYBOX_ROOT}/toys/posix/xargs.c
        )

execute_process(COMMAND sed s/\#define.*TOYBOX_VERSION.*\"\\\(.*\\\)\"/\\1/p\;d main.c
        WORKING_DIRECTORY ${TOYBOX_ROOT}
        OUTPUT_VARIABLE TOYBOX_VERSION
        )
string(STRIP ${TOYBOX_VERSION} TOYBOX_VERSION)
set(TOYBOX_VERSION "${TOYBOX_VERSION}-android")

include_directories(${TOYBOX_ROOT})

add_executable(toybox ${SOURCE_FILES})
target_compile_definitions(toybox PRIVATE
        -DTOYBOX_VERSION=\"${TOYBOX_VERSION}\"
        )
target_compile_options(toybox PRIVATE
        -std=c99
        -Os
        -Wno-char-subscripts
        -Wno-gnu-variable-sized-type-not-at-end
        -Wno-missing-field-initializers
        -Wno-sign-compare
        -Wno-string-plus-int
        -Wno-uninitialized
        -Wno-unused-parameter
        -funsigned-char
        -ffunction-sections -fdata-sections
        -fno-asynchronous-unwind-tables
        )
target_link_libraries(toybox
        liblog
        libselinux
        libcutils
        libcrypto
        libz
        )