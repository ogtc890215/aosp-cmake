set(LOCAL_PATH ${KERNEL_ROOT}/drivers/base)

set(SOURCE_FILES "")

add_c_source(SOURCE_FILES ${LOCAL_PATH} core)
add_c_source(SOURCE_FILES ${LOCAL_PATH} bus)
add_c_source(SOURCE_FILES ${LOCAL_PATH} dd)
add_c_source(SOURCE_FILES ${LOCAL_PATH} syscore)

add_c_source(SOURCE_FILES ${LOCAL_PATH} driver)
add_c_source(SOURCE_FILES ${LOCAL_PATH} class)
add_c_source(SOURCE_FILES ${LOCAL_PATH} platform)

add_c_source(SOURCE_FILES ${LOCAL_PATH} cpu)
add_c_source(SOURCE_FILES ${LOCAL_PATH} firmware)
add_c_source(SOURCE_FILES ${LOCAL_PATH} init)
add_c_source(SOURCE_FILES ${LOCAL_PATH} map)
add_c_source(SOURCE_FILES ${LOCAL_PATH} devres)

add_c_source(SOURCE_FILES ${LOCAL_PATH} attribute_container)
add_c_source(SOURCE_FILES ${LOCAL_PATH} transport_class)

add_c_source(SOURCE_FILES ${LOCAL_PATH} topology)


if (${CONFIG_DEVTMPFS})
    add_c_source(SOURCE_FILES ${LOCAL_PATH} devtmpfs)
endif ()
if (${CONFIG_CMA})
    add_c_source(SOURCE_FILES ${LOCAL_PATH} dma-contiguous)
    add_c_source(SOURCE_FILES ${LOCAL_PATH} dma-removed)
endif ()

if (${CONFIG_HAS_DMA})
    add_c_source(SOURCE_FILES ${LOCAL_PATH} dma-mapping)
endif ()
if (${CONFIG_HAVE_GENERIC_DMA_COHERENT})
    add_c_source(SOURCE_FILES ${LOCAL_PATH} dma-coherent)
endif ()
if (${CONFIG_DMA_SHARED_BUFFER})
    add_c_source(SOURCE_FILES ${LOCAL_PATH} dma-buf)
endif ()
if (${CONFIG_ISA})
    add_c_source(SOURCE_FILES ${LOCAL_PATH} isa)
endif ()
if (${CONFIG_FW_LOADER})
    add_c_source(SOURCE_FILES ${LOCAL_PATH} firmware_class)
endif ()
if (${CONFIG_NUMA})
    add_c_source(SOURCE_FILES ${LOCAL_PATH} node)
endif ()
if (${CONFIG_MEMORY_HOTPLUG_SPARSE})
    add_c_source(SOURCE_FILES ${LOCAL_PATH} memory)
endif ()
if (${CONFIG_SYSFS})
    if (${CONFIG_MODULES})
        add_c_source(SOURCE_FILES ${LOCAL_PATH} module)
    endif ()
endif ()
if (${CONFIG_SYS_HYPERVISOR})
    add_c_source(SOURCE_FILES ${LOCAL_PATH} hypervisor)
endif ()

if (${CONFIG_SOC_BUS})
    add_c_source(SOURCE_FILES ${LOCAL_PATH} soc)
endif ()
if (${CONFIG_PINCTRL})
    add_c_source(SOURCE_FILES ${LOCAL_PATH} pinctrl)
endif ()

add_library(drivers-base STATIC ${SOURCE_FILES})
target_include_directories(drivers-base PRIVATE ${LOCAL_PATH})

add_subdirectory(power)
target_link_libraries(drivers-base drivers-base-power)
if (${CONFIG_REGMAP})
    add_subdirectory(regmap)
    target_link_libraries(drivers-base drivers-base-regmap)
endif ()